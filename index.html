<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>member-hooks</title>
	<meta name="description" content="Documentation for member-hooks">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">member-hooks</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>member-hooks</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#member-hooks" id="member-hooks" style="color: inherit; text-decoration: none;">
					<h1>member-hooks</h1>
				</a>
				<p>Add before and after hooks to an object</p>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h1>Installation</h1>
				</a>
				<pre><code>yarn <span class="hljs-keyword">add</span><span class="bash"> member-hooks</span>
npm install member-hooks</code></pre>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h1>Usage</h1>
				</a>
				<p>A hook is a function that defines a set of before/at/after functions on methods of an object.
					The before functions, when present, are executed before the method in order of priority.
					The after functions, when present, are executed after the method in order of priority.
				The at function with the highest priority, when present, replaces the method</p>
				<p>Hooks must be registered by calling the register method on an instance of the Hooks class.  </p>
				<p>To install/uninstall an array of hooks to an object, call the install/uninstall method.
					The hooks to install are specified as an array of [&#39;hookName&#39;, hookOptions] arrays.
				Where hookName is the name under which the hook was registered.</p>
				<p>The after hook can return a context object that will be passed to the after hook as 3rd argument.</p>
				<p>A hook function can optionally return a create function that will be called at install.
					This create function can optionally return a destroy function that will be call at uninstall.
				The create function receives the target and optional context argument passed to install.</p>
				<p>Example:</p>
				<pre><code class="language-typescript"><span class="hljs-keyword">import</span> test <span class="hljs-keyword">from</span> <span class="hljs-string">'ava'</span>
<span class="hljs-keyword">import</span> sinon <span class="hljs-keyword">from</span> <span class="hljs-string">'sinon'</span>
<span class="hljs-keyword">import</span> { HookMethods, Hooks, TCreate } <span class="hljs-keyword">from</span> <span class="hljs-string">'.'</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ensureNumber</span>(<span class="hljs-params">methods: HookMethods, options: { defaultValue: <span class="hljs-built_in">number</span>, createSpy: TCreate }</span>): <span class="hljs-title">TCreate</span> </span>{
  <span class="hljs-keyword">const</span> { defaultValue, createSpy } = { defaultValue: <span class="hljs-number">0</span>, ...options }
  <span class="hljs-comment">// add before hook to 'negative' method at priority 5</span>
  methods.before(<span class="hljs-string">'negative'</span>, <span class="hljs-number">5</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args: <span class="hljs-built_in">any</span>[]</span>): <span class="hljs-title">void</span> </span>{
    <span class="hljs-keyword">const</span> value = args[<span class="hljs-number">0</span>]
    args[<span class="hljs-number">0</span>] = <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'number'</span> ? value : defaultValue
  })
  <span class="hljs-keyword">return</span> createSpy
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">minMax</span>(<span class="hljs-params">methods: HookMethods, options: { min: <span class="hljs-built_in">number</span>, max: <span class="hljs-built_in">number</span> }</span>): <span class="hljs-title">void</span> </span>{
  <span class="hljs-keyword">const</span> { min, max } = { min: <span class="hljs-number">0</span>, max: <span class="hljs-number">100</span>, ...options }
  <span class="hljs-comment">// add before hook to 'negative' method at priority 10 (executed after ensureNumber)</span>
  methods.before(<span class="hljs-string">'negative'</span>, <span class="hljs-number">10</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args: <span class="hljs-built_in">any</span>[]</span>): <span class="hljs-title">void</span> </span>{
    args[<span class="hljs-number">0</span>] = <span class="hljs-built_in">Math</span>.max(<span class="hljs-built_in">Math</span>.min(args[<span class="hljs-number">0</span>], max), min)
  })
  <span class="hljs-comment">// add after hook to 'add' method at priority -100</span>
  methods.after(<span class="hljs-string">'add'</span>, <span class="hljs-number">-100</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result: <span class="hljs-built_in">number</span></span>): <span class="hljs-title">number</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.max(<span class="hljs-built_in">Math</span>.min(result, max), min)
  })
}

<span class="hljs-keyword">class</span> TestClass {
  <span class="hljs-keyword">public</span> negative(value: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">any</span> {
    <span class="hljs-keyword">return</span> -value
  }

  <span class="hljs-keyword">public</span> add(a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> a + b
  }
}

test(<span class="hljs-string">'TestClass'</span>, <span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> {
  <span class="hljs-comment">// register hooks</span>
  <span class="hljs-keyword">const</span> hooks = <span class="hljs-keyword">new</span> Hooks()
  hooks.register(<span class="hljs-string">'ensureNumber'</span>, ensureNumber)
  hooks.register(<span class="hljs-string">'minMax'</span>, minMax)

  <span class="hljs-comment">// install/uninstall the hooks on test object</span>
  <span class="hljs-keyword">const</span> testInstance = <span class="hljs-keyword">new</span> TestClass()
  <span class="hljs-comment">// The hooks to install are specified as an array of array where the inner array</span>
  <span class="hljs-comment">// has the format ['hookName', hookOptions]</span>
  <span class="hljs-keyword">const</span> destroySpy = sinon.spy()
  <span class="hljs-keyword">const</span> createSpy = sinon.spy(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> destroySpy)
  hooks.install(testInstance, [
    [<span class="hljs-string">'minMax'</span>, { min: <span class="hljs-number">0</span>, max: <span class="hljs-number">100</span> }],
    [<span class="hljs-string">'ensureNumber'</span>, { defaultValue: <span class="hljs-number">200</span>, createSpy }]
  ])

  t.assert(testInstance.negative(<span class="hljs-literal">undefined</span>) === <span class="hljs-number">-100</span>)
  t.assert(testInstance.add(<span class="hljs-number">100</span>, <span class="hljs-number">200</span>) === <span class="hljs-number">100</span>)

  hooks.uninstall(testInstance)
  t.assert(destroySpy.calledOnce)
})</code></pre>
				<a href="#before-hook" id="before-hook" style="color: inherit; text-decoration: none;">
					<h1>Before hook</h1>
				</a>
				<p>A before-hook is a function executed before a method.
					It receives all arguments passed to the method as an array.
					This allows the before-hook to change the arguments passed to the method before it is called.
				When defined as a normal function (not arrow function), &#39;this&#39; refers to the object of the method.</p>
				<p>Example: A before hook that ensures the first argument to the method is an object with an id field</p>
				<pre><code class="language-typescript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beforeHook</span>(<span class="hljs-params">args: <span class="hljs-built_in">any</span>[]</span>): <span class="hljs-title">void</span> </span>{
  <span class="hljs-keyword">let</span> doc = args[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">if</span> (!isObject(doc)) {
    doc = {}
  }
  <span class="hljs-keyword">if</span> (!(<span class="hljs-string">'id'</span> <span class="hljs-keyword">in</span> doc)) {
    doc.id = uuid()
  }
  args[<span class="hljs-number">0</span>] = doc
}</code></pre>
				<a href="#after-hook" id="after-hook" style="color: inherit; text-decoration: none;">
					<h1>After hook</h1>
				</a>
				<p>A after-hook is a function executed after a method.
					It receives the value returned from the method and an array of arguments passed to the method.
					This allows the after-hook to modify the returned value.
				When defined as a normal function (not arrow function), &#39;this&#39; refers to the object of the method.</p>
				<p>Example: afterHook validates wether returned value is smaller then then the first method argument</p>
				<pre><code class="language-typescript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">afterHook</span>(<span class="hljs-params">result: <span class="hljs-built_in">number</span>, args: <span class="hljs-built_in">any</span>[]</span>): <span class="hljs-title">number</span> </span>{
  <span class="hljs-keyword">const</span> max = args[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">if</span> (result &gt; max) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${result}</span> should be smaller then <span class="hljs-subst">${max}</span>`</span>)
  }
  <span class="hljs-keyword">return</span> result
}</code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-namespace">
						<a href="modules/_binary_sorted_array_.html">&quot;binary-<wbr>sorted-<wbr>array&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-class">
						<a href="classes/collection.html" class="tsd-kind-icon">Collection</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/hookmethods.html" class="tsd-kind-icon">Hook<wbr>Methods</a>
					</li>
					<li class=" tsd-kind-class">
						<a href="classes/hooks.html" class="tsd-kind-icon">Hooks</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/thookmethod.html" class="tsd-kind-icon">THook<wbr>Method</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/tidoptions.html" class="tsd-kind-icon">TId<wbr>Options</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/tobj.html" class="tsd-kind-icon">TObj</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/toldmethod.html" class="tsd-kind-icon">TOld<wbr>Method</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/tprioritizedhookmethod.html" class="tsd-kind-icon">TPrioritized<wbr>Hook<wbr>Method</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/tseqoptions.html" class="tsd-kind-icon">TSeq<wbr>Options</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#taftermethod" class="tsd-kind-icon">TAfter<wbr>Method</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#tbeforemethod" class="tsd-kind-icon">TBefore<wbr>Method</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#tcreate" class="tsd-kind-icon">TCreate</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#tdecorator" class="tsd-kind-icon">TDecorator</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#tdestroy" class="tsd-kind-icon">TDestroy</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#thookfactory" class="tsd-kind-icon">THook<wbr>Factory</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#tjsonhook" class="tsd-kind-icon">TJSONHook</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#tmethod" class="tsd-kind-icon">TMethod</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#tmethoddecorator" class="tsd-kind-icon">TMethod<wbr>Decorator</a>
					</li>
					<li class=" tsd-kind-type-alias">
						<a href="globals.html#tunhook" class="tsd-kind-icon">TUnhook</a>
					</li>
					<li class=" tsd-kind-variable">
						<a href="globals.html#unhook" class="tsd-kind-icon">UNHOOK</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#contexthook" class="tsd-kind-icon">context<wbr>Hook</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#createdecorator" class="tsd-kind-icon">create<wbr>Decorator</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#id" class="tsd-kind-icon">id</a>
					</li>
					<li class=" tsd-kind-function">
						<a href="globals.html#seq" class="tsd-kind-icon">seq</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html>